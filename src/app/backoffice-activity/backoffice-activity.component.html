<div class="container">
    <!-- Botó per crear activitat -->
    <div class="action-buttons">
      <button class="btn-create" (click)="showCreateActivityForm()">
        <i class="material-icons">add</i> Crear nueva actividad
      </button>
    </div>
    
    <!-- Inicialment només mostrar botó d'inicialitzar -->
    <div class="button-container" *ngIf="!activitiesListed">
      <button class="btn-listar" (click)="obtenerActividades()">
        Listar todas las actividades
      </button>
    </div>
    
    <!-- Llista paginada d'activitats -->
    <div class="activities-container" *ngIf="activitiesListed">
      <h2>Actividades</h2>
      
      <!-- Filtre per tipus d'activitat -->
      <div class="filter-container">
        <label for="activity-type">Filtrar por tipo:</label>
        <select id="activity-type" [(ngModel)]="selectedType" (change)="filterActivities()">
          <option value="">Todos</option>
          <option value="running">Running</option>
          <option value="cycling">Cycling</option>
          <option value="hiking">Hiking</option>
          <option value="walking">Walking</option>
        </select>
      </div>
      
      <!-- Taula d'activitats -->
      <div class="activities-grid">
        <div *ngFor="let activity of filteredActivities; trackBy: trackByActivityId" 
             class="activity-card">
  
          <div class="activity-header">
            <div class="activity-type-badge" [ngClass]="activity.type">
              {{ activity.type }}
            </div>
            <h3 class="activity-name">{{ activity.name }}</h3>
          </div>
          
          <div class="activity-info">
            <p><strong>Autor:</strong> {{ activity.authorName || 'Desconocido' }}</p>
            <p><strong>Fecha:</strong> {{ activity.startTime | date:'dd/MM/yyyy HH:mm' }}</p>
            <p><strong>Duración:</strong> {{ formatDuration(activity.duration) }}</p>
            <p><strong>Distancia:</strong> {{ (activity.distance / 1000).toFixed(2) }} km</p>
            <p><strong>Velocidad media:</strong> {{ activity.averageSpeed.toFixed(1) }} km/h</p>
          </div>
          
          <div class="activity-actions">
            <button class="btn-edit" (click)="editarActividad(activity)">
              <i class="material-icons">edit</i> Editar
            </button>
            <button class="btn-delete" (click)="eliminarActividad(activity)">
              <i class="material-icons">delete</i> Eliminar
            </button>
            <button class="btn-view" (click)="verDetallesActividad(activity)">
              <i class="material-icons">visibility</i> Ver
            </button>
          </div>
        </div>
      </div>
      
      <!-- Missatge si no hi ha activitats -->
      <div *ngIf="filteredActivities.length === 0" class="no-data">
        No se encontraron actividades.
      </div>
      
      <!-- Paginació -->
      <div class="pagination-controls" *ngIf="totalPages > 1">
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 1"
          (click)="changePage(currentPage - 1)">
          « Anterior
        </button>
        
        <span *ngFor="let page of pages" 
              class="page-number" 
              [class.active]="page === currentPage"
              (click)="changePage(page)">
          {{page}}
        </span>
        
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === totalPages"
          (click)="changePage(currentPage + 1)">
          Siguiente »
        </button>
      </div>
      
      <div class="pagination-info" *ngIf="totalActivities > 0">
        Mostrando página {{ currentPage }} de {{ totalPages }} 
        ({{ totalActivities }} actividades en total)
      </div>
    </div>
  
    <!-- Crear activitat -->
    <div class="full-screen-form" *ngIf="showCreateModal">
      <app-activity-create (activityCreated)="onActivityCreated($event)"></app-activity-create>
    </div>
  
    <!-- Editar activitat -->
    <div class="full-screen-form" *ngIf="showEditModal && selectedActivity">
      <div class="modal-header">
        <h2>Editar Actividad: {{ selectedActivity.name }}</h2>
        <button class="close-btn" (click)="showEditModal = false">×</button>
      </div>
      <div class="modal-body">
        <form class="edit-form">
          <!-- Camps per editar activitat -->
          <div class="form-group">
            <label for="edit-name">Nombre de la actividad</label>
            <input type="text" id="edit-name" [(ngModel)]="selectedActivity.name" name="name" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-type">Tipo</label>
            <select id="edit-type" [(ngModel)]="selectedActivity.type" name="type" class="form-control">
              <option value="running">Running</option>
              <option value="cycling">Cycling</option>
              <option value="hiking">Hiking</option>
              <option value="walking">Walking</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="edit-startTime">Fecha y hora de inicio</label>
            <input type="datetime-local" id="edit-startTime" 
                   [(ngModel)]="formattedStartTime" name="startTime" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-endTime">Fecha y hora de finalización</label>
            <input type="datetime-local" id="edit-endTime" 
                   [(ngModel)]="formattedEndTime" name="endTime" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-duration">Duración (minutos)</label>
            <input type="number" id="edit-duration" [(ngModel)]="selectedActivity.duration" 
                   name="duration" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-distance">Distancia (metros)</label>
            <input type="number" id="edit-distance" [(ngModel)]="selectedActivity.distance" 
                   name="distance" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-elevationGain">Ganancia de elevación (metros)</label>
            <input type="number" id="edit-elevationGain" [(ngModel)]="selectedActivity.elevationGain" 
                   name="elevationGain" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-averageSpeed">Velocidad media (km/h)</label>
            <input type="number" id="edit-averageSpeed" [(ngModel)]="selectedActivity.averageSpeed" 
                   name="averageSpeed" class="form-control">
          </div>
          
          <div class="form-group">
            <label for="edit-caloriesBurned">Calorías quemadas</label>
            <input type="number" id="edit-caloriesBurned" [(ngModel)]="selectedActivity.caloriesBurned" 
                   name="caloriesBurned" class="form-control">
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn-cancel" (click)="showEditModal = false">Cancelar</button>
            <button type="button" class="btn-save" (click)="onActivityEdited(true)">Guardar cambios</button>
          </div>
        </form>
      </div>
    </div>
  
    <!-- Detalls de la activitat -->
    <div class="full-screen-form view-details" *ngIf="showViewModal && selectedActivity">
      <div class="modal-header">
        <h2>Detalles de la Actividad</h2>
        <button class="close-btn" (click)="closeViewModal()">×</button>
      </div>
      <div class="modal-body activity-details">
        <div class="activity-profile">
          <div class="activity-type-badge large" [ngClass]="selectedActivity.type">
            {{ selectedActivity.type }}
          </div>
          <h3>{{ selectedActivity.name }}</h3>
        </div>
        
        <div class="activity-details-info">
          <p><strong>ID:</strong> {{ selectedActivity._id }}</p>
          <p><strong>Autor:</strong> {{ selectedActivity.authorName || 'Desconocido' }}</p>
          <p><strong>Fecha de inicio:</strong> {{ selectedActivity.startTime | date:'dd/MM/yyyy HH:mm' }}</p>
          <p><strong>Fecha de finalización:</strong> {{ selectedActivity.endTime | date:'dd/MM/yyyy HH:mm' }}</p>
          <p><strong>Duración:</strong> {{ formatDuration(selectedActivity.duration) }}</p>
          <p><strong>Distancia:</strong> {{ (selectedActivity.distance / 1000).toFixed(2) }} km</p>
          <p><strong>Ganancia de elevación:</strong> {{ selectedActivity.elevationGain }} m</p>
          <p><strong>Velocidad media:</strong> {{ selectedActivity.averageSpeed.toFixed(1) }} km/h</p>
          <p><strong>Calorías quemadas:</strong> {{ selectedActivity.caloriesBurned || 'No especificado' }}</p>
          
          <div *ngIf="selectedActivity.route && selectedActivity.route.length > 0">
            <p><strong>Puntos de ruta:</strong> {{ selectedActivity.route.length }} puntos</p>
          </div>
          
          <div *ngIf="selectedActivity.musicPlaylist && selectedActivity.musicPlaylist.length > 0">
            <p><strong>Playlist:</strong> {{ selectedActivity.musicPlaylist.length }} canciones</p>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-back" (click)="closeViewModal()">Volver a la lista</button>
        </div>
      </div>
    </div>
  </div>